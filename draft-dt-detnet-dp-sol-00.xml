<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc2119 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY rfc3031 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3031.xml">
<!ENTITY rfc3032 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3032.xml">
<!ENTITY rfc3985 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3985.xml">
<!ENTITY rfc4023 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4023.xml">
<!ENTITY rfc4385 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4385.xml">
<!ENTITY rfc4446 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4446.xml">
<!ENTITY rfc4447 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4447.xml">
<!ENTITY rfc4448 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4448.xml">
<!ENTITY rfc4553 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4553.xml">
<!ENTITY rfc4664 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4664.xml">
<!ENTITY rfc4817 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4817.xml">
<!ENTITY rfc4875 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4875.xml">
<!ENTITY rfc5086 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5086.xml">
<!ENTITY rfc5087 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5087.xml">
<!ENTITY rfc5254 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5254.xml">
<!ENTITY rfc5129 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5129.xml">
<!ENTITY rfc5305 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5305.xml">
<!ENTITY rfc5331 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5331.xml">
<!ENTITY rfc5332 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5332.xml">
<!ENTITY rfc5440 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5440.xml">
<!ENTITY rfc5462 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5462.xml">
<!ENTITY rfc5586 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5586.xml">
<!ENTITY rfc5659 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5659.xml">
<!ENTITY rfc5921 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5921.xml">
<!ENTITY rfc5960 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5960.xml">
<!ENTITY rfc6073 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6073.xml">
<!ENTITY rfc6275 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6275.xml">
<!ENTITY rfc6371 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6371.xml">
<!ENTITY rfc6373 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6373.xml">
<!ENTITY rfc6378 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6378.xml">
<!ENTITY rfc6426 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6426.xml">
<!ENTITY rfc6437 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6437.xml">
<!ENTITY rfc6540 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6540.xml">
<!ENTITY rfc6564 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6564.xml">
<!ENTITY rfc6621 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6621.xml">
<!ENTITY rfc6658 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6658.xml">
<!ENTITY rfc6718 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6718.xml">
<!ENTITY rfc6733 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6733.xml">
<!ENTITY rfc6790 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6790.xml">
<!ENTITY rfc7271 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7271.xml">
<!ENTITY rfc7348 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7348.xml">
<!ENTITY rfc7426 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7426.xml">
<!ENTITY rfc7432 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7432.xml">
<!ENTITY rfc7510 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7510.xml">

<!ENTITY I-D.ietf-detnet-dp-alt PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-detnet-dp-alt.xml">
<!ENTITY I-D.ietf-detnet-problem-statement PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-detnet-problem-statement.xml">
<!ENTITY I-D.ietf-detnet-architecture PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-detnet-architecture.xml">
<!ENTITY I-D.ietf-mpls-residence-time SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-mpls-residence-time">


]>

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc iprnotified="no"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="info"
     docName="draft-ietf-detnet-dp-sol-00"
         ipr="trust200902"
         submissionType="IETF">
  <front>
    <title abbrev="DetNet data plane protocol">
     DetNet Data Plane Protocol</title>

  <author role="editor" fullname="Jouni Korhonen" initials="J." surname="Korhonen">
   <organization abbrev="Broadcom">Broadcom</organization>
   <address>
    <postal>
     <street>3151 Zanker Road</street>
     <city>San Jose</city>
     <code>95134</code>
     <region>CA</region>
     <country>USA</country>
    </postal>
    <email>jouni.nospam@gmail.com</email>
   </address>
  </author>

  <author fullname="Donald Fauntleroy Duck" initials="D. F." surname="Duck">
   <organization abbrev="Royal Bros.">Royal Bros.</organization>
   <address>
    <postal>
     <street>13 Paradise Road</street>
     <city>Duckburg</city>
     <region>Calisota</region>
     <country>USA</country>
    </postal>
   </address>
  </author>
  <date />
  <workgroup>DetNet</workgroup>

  <abstract>
  <t>
   This document specifies a PseudoWire-based Determnistic Networking data
   plane protocol solutoon. The data plane protocol runs over either IP or MPLS
   Packet Switched Networks.
  </t>
  </abstract>


  </front>

 <middle>
 <section title="Introduction" anchor="sec_intro">
  <t>
   This document specifies a Deterministic Networking (DetNet) data plane
   protocol. The solution is based on PseudoWires (PW) <xref target="RFC3985"/>
   and makes use of the multi-segment (MS-PW) <xref target="RFC6073"/> to map
   DetNet Relays and Edge Nodes <xref
   target="I-D.ietf-detnet-architecture"/><xref
   target="I-D.ietf-detnet-dp-alt"/> to PW architecture. The PW-based data
   plane can be run over either an IP or MPLS <xref target="RFC4448"/><xref
   target="RFC6658"/> Packet Switched Network (PSN).
  </t>
  <t>
   For the purpose of DetNet data plane this document specifically specifies
   the PW encapsulation for DetNet flows, a DetNet Control Word (CW), a DetNet
   label, how MS-PW derived DetNet Relay and Edge nodes work, and as a specific
   new PW feature how the Frame Replication and Elimination for Redundancy
   (FRER) is implemented using PWs. This document does not define the
   associated control plane functions, or operations and management (O&amp;M).
  </t>
 </section>

 <section title="Terminology">
  <t>
   This document uses the terminology established in the DetNet architecture
   <xref target="I-D.ietf-detnet-architecture"/> and the DetNet Data Plane
   Solution Alternatives <xref target="I-D.ietf-detnet-dp-alt"/>.
  </t>
  <t>
   The following terms are also used in this document:
   <list style="hanging" hangIndent="14">
    <t hangText="T-DetNet-PE">A DetNet aware PseudoWire Terminating Provider Edge (T-PE).
     In the context of this document T-DetNet-PE is referred as T-PE.</t>
    <t hangText="S-DetNet-PE">A DetNet aware PseudoWire Switching Provider Edge (S-PE).
     In the context of this document S-DetNet-PE is referred as S-PE.</t>
    <t hangText="T-Label">A hop-by-hop tunnel label layer between laber switch routers (LSR).</t>
    <t hangText="d-PW Label">A PseudoWire label that is used to identify DetNet flows.</t>
    <t hangText="v-PW Label">A virtual label that within a label information base (LIB) or
     label forwarding information base (LFIB) groups one or more d-PW labels to a single
     label for a node internal use. The v-PW can be one of the grouped d-PW labels, or
     a label value that is unique within the LFIB and never seen on-wire.</t>
   </list>
  </t>
 </section>

 <section title="Requirements language">
  <t>
   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL"
   "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
   and "OPTIONAL" in this document are to be interpreted as
   described in <xref target="RFC2119"/>.
  </t>
 </section>

 <section title="DetNet data plane Overview" anchor="sec_dt_dp">
  <t>
   [Ed. to be written.. describe the scope here fot this document: this
   document only addresses the inter-connect case i.e., 802.1 over routed
   network (enlarge the layer-2 domain - EVPAN', and the native DetNet
   case.]
  </t>
  <figure anchor="fig_detnet" align="center"
  title="A simple DetNet enabled network architecture">
  <artwork align="center"><![CDATA[
TSN              Edge          Transit        Relay        DetNet
End System       Node            Node         Node         End System

+---------+    +.........+                                 +---------+
|  Appl.  |<---:Svc Proxy:-- End to End Service ---------->|  Appl.  |
+---------+    +---------+                   +---------+   +---------+
|   TSN   |    |TSN| |Svc|<-- DetNet flow ---: Service :-->| Service |
+---------+    +---+ +---+    +---------+    +---------+   +---------+
|Transport|    |Trp| |Trp|    |Transport|    |Trp| |Trp|   |Transport|
+-------.-+    +-.-+ +-.-+    +--.----.-+    +-.-+ +-.-+   +---.-----+
        :  Link  :    /  ,-----.  \   :  Link  :    /  ,-----.  \
        +........+    +-[  Sub  ]-+   +........+    +-[  Sub  ]-+
                        [Network]                     [Network]
                         `-----'                       `-----'
]]></artwork>
</figure>


  <t>
   <xref target="fig_8021_detnet"/> illustrates how DetNet can provide services
   for IEEE 802.1TSN end systems over a DetNet enabled network.  The edge nodes
   insert and remove required DetNet data plane encapsulation.  The 'X' in
   the edge and relay nodes represents a potential DetNet flow packet
   replication and elimination point.  This conceptually parallels L2VPN
   services, and could leverage existing related solutions as discussed
   below.
  </t>

  <figure align="center" anchor="fig_8021_detnet"
  title="IEEE 802.1TSN over DetNet">
  <artwork><![CDATA[
       TSN    |<----- End to End DetNet Service ----->|  TSN
      Service |        Transit          Transit       | Service
TSN    (AC)   |     |<-Tunnel->|     |<-Tunnel->|     |  (AC)     TSN
End     |     V     V     1    V     V     2    V     V   |       End
System  |     +-----+          +-----+          +---- +   |    System
+---+   |     |T-PE1|==========|S-PE1|==========|T-PE2|   |    +---+
|   |---|-----|.X_..DetNet Flow1..X..|...DF3........X.|---|----|   |
|CE1|   |     |  \  |          |     |          |  /  |   |    |CE2|
|   |         |...X_...DF2........X..|...DF4......X_..|        |   |
+---+         |     |==========|     |==========|     |        +---+
    ^         +-----+          +-----+          +-----+        ^
    |        Edge Node        Relay Node       Edge Node       |
    |                                                          |
    |<--------------- Emulated TSN Service ------------------->|
]]></artwork>
</figure>

 <t>
  <xref target="fig_native_detnet"/> illustrates how end to end native DetNet
  service can be provided. In this case, the end systems are able to send and
  receive native DetNet flows.  For example, as PseudoWire (PW) encapsulated
  IP.  Like earlier the 'X' in the end systems, edge and relay nodes represents
  potential DetNet flow packet replication and elimination points. Here the
  relay nodes may change the underlying transport, for example replacing IP
  with MPLS or tunneling IP over MPLS (e.g., via L3VPNs), or simply
  interconnect network domains.
 </t>

<figure align="center" anchor="fig_native_detnet"
 title="Native DetNet">
<artwork><![CDATA[
       DetNet                                           DetNet
       Service         Transit          Transit        Service
DetNet   |          |<-Tunnel->|     |<-Tunnel->|         |    DetNet
End      |          V     1    V     V     2    V         |    End
System   |    +-----+          +-----+          +-----+   |    System
+---+    |    |S-PE1|==========|S-PE2|==========|S-PE3|   |    +---+
|  X....DFa.....X_.......DF1.......X_....DF3........X.....DFa...X  |
|CE1|=========|  \  |          |  /  |          |  /  |========|CE2|
|   |    |    |   \......DF2.....X_......DF4....../   |   |    |   |
+---+         |     |==========|     |==========|     |        +---+
    ^         +-----+          +-----+          +-----+        ^
    |        Relay Node       Relay Node       Relay Node      |
    |                                                          |
    |<------------- End to End DetNet Service ---------------->|
]]></artwork>
</figure>
</section>

<!-- ================================================================= -->

<section title="DetNet data plane solution">
 <t>
  [Ed. introduction]
 </t>

 <section title="DetNet Control Word">
  <t>
   The DetNet control word (d-CW) is identical to the control word defined for
   Ethernet over MPLS networks in <xref target="RFC4448"/>. The DetNet control
   word is illustrated in <xref target="fig_detnet_cw"/>.
  </t>
    <figure title="DetNet Control Word" anchor="fig_detnet_cw">
    <artwork align="center"><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 0 0 0|  reserved - set to 0  |   16 bit Sequence Number      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]>
    </artwork></figure>
</section>

 <section title="DetNet encapsulation">
  <t>
   The DetNet data plane follows PW encapsulation. This document specifies a
   single encapsulation that can be used over both MPLS and IP packet switched
   Networks (PSN). The DetNet data plane encapsulation consists of a
   <list style="symbols">
    <t>DetNet control word (d-CW): contains sequencing information for
     frame replication and duplicate elimination purposes. There is a separate
     sequence number space per each DetNet label.</t>
    <t>PseudoWire Label (d-PW): a standard PW label that identifies a PW Instance
     within a T-PE or S-PE device.</t>
    <t>DetNet topology overlay label (L-label): a label used  between DetNet aware
     T-PE or S-PE devices.</t>
   </list>
   In a case of MPLS-based PSN, the tunnel labels between LSRs are referred as
   T-lables.
  </t>
  <t>
   [Ed. the encapsulation is still in flux. Somw rearrangement has been done
    to be more PW architecture compliant. One of the issues is still whether
    the d-PW label can actually be global throughout the DetNet domain.]
  </t>

  <section title="Encasulation for MPLS PSN">

    <figure title="Encapsulation of DetNet flow in a PW with MPLS(-TP) PSN" anchor="fig_pw_mpls">
    <artwork align="center"><![CDATA[
+-------------------------------+
|                               |
|          DetNet Flow          |
|        Payload  Packet        |  n octets
|                               |
+-------------------------------+
|      DetNet Control Word      |  4 octets
+-------------------------------+
|          PW Label             |  4 octets
+-------------------------------+
| DetNet topology overlay Label |  4 octets
+-------------------------------+
|   Server MPLS Tunnel Label(s) |  n*4 octets (four octets per label)
+-------------------------------+
]]>
    </artwork></figure>

   </section>

   <section title="Encapsulation for IP PSN">

    <figure title="Encapsulation of DetNet flow in a PW with IP PSN" anchor="fig_pw_ip">
    <artwork align="center"><![CDATA[
+-------------------------------+
|                               |
|          DetNet Flow          |
|        Payload  Packet        |  n octets
|                               |
+-------------------------------+
|      DetNet Control Word      |  4 octets
+-------------------------------+
|          PW Label             |  4 octets
+-------------------------------+
| DetNet topology overlay Label |  4 octets
+-------------------------------+
|      Optional UDP Header      |  0 or 8 octets
+-------------------------------+
|      IPv4 or IPv6 Header      |  20 or 40 (or more octets
+-------------------------------+  with extension headers)
]]>
    </artwork></figure>
  </section>

  <section title="PW-Label assignment and distribution">
   <t>
    [Ed. Describe here details of the PW-labels.. to be decided whether they
     are global throughpout the DetNEt domain, or each x-PE device may have
     they own label space. The latter would need additional considerations to
     index/identify the DetNet flow.. maybe something similar to segment
     routing anycast label algorithms..?]
   </t>
  </section>
 </section>

  <section title="PE reference model considerations">
   <section title="Forwarded clarifications">
    <t>
     [Ed. To be revisited.. the comments and text below are most likely out of
     date regarding the latest discussions in the DT.]
    </t>
    <t>
     [Ed. The Detnet-aware "extended forwarder" does the heavy lifting on maintaining
     the sequence numbers associated with the DetNet labels. Extended forwarder is also
     responsible for frame replication and duplicate elimination. See the excerpt from
     RFC3985 Section 4.2.1. about forwarder's functions. We extend that to FRER:
     <list style="none">
     <t>
       Some applications have to forward payload elements selectively from
       one or more ACs to one or more PWs.  In such cases, there will also be
       a need to perform the inverse function on PWE3-PDUs received by a PE
       from the PSN.  This is the function of the forwarder.
     </t></list>
     ]
    </t>
   </section>

   <section title="T-DetNet-PE processing clarifications" anchor="sec_t_pe">
    <t>
     The PW-based DetNet data plane solution overloads the T-PE with a DetNet
     Edge Node function. Such T-PE is referred as T-DetNet-PE and implies the
     T-PE is also aware of DetNet flows and may need to operate upon those.
     <xref target="fig_detnet_edge"/> illustrates the overall T-PE device
     functions. The figure shows both physical attachment circuit (AC) (e.g.,
     Ethernet <xref target="RFC4448"/>) connecting to the PE, and a packet
     service connecting to the PE via an embedded label switch router (LSR)
     function <xref target="RFC6658"/>.
    </t>

    <figure title="DetNet Edge Node as a T-PE" anchor="fig_detnet_edge">
    <artwork align="center"><![CDATA[
            +---------------------------------------+
            |          T-DetNEt-PE Device           |
            +---------------------------------------+   Egress/
            |             | Forwarder |             |   Ingress
            |  LSR        |           |    Single   | PW Instance
Client PSN  |  ("Packet   X <-*-----> X PW Instance X<---------->
LSPs        |    NSP")    |   | Repl. |             |
<---------->X             |   | Elim. +-------------+ Duplicate
            |             |   :       |             |   Egress
            |             |   .       |    Single   | PW Instance
            |             |       +-> X PW Instance X<---------->
            |             |       |   |             |
            +-------------+       |   +-------------+   Egress/
            |             |       |   |             |   Ingress
Client AC   |    NSP      | Repl. |   |    Single   | PW Instance
<---------->X             X <-----*-> X PW Instance X<---------->
            |             | Elim.     |             |
            +-------------+           +-------------+   Egress/
            |             |           |             |   Ingress
Client AC   |    NSP      |           |    Single   | PW Instance
<---------->X             X <-------> X PW Instance X<---------->
            |             |           |             |
            +---------------------------------------+
]]>
    </artwork></figure>

    <t>
     DetNet-aware T-PE participates to the frame replication and duplication
     elimination. Required processing is done within an extended forwarder
     function. In the case the native service processing (NSP) is IEEE 802.1CB
     <xref target="IEEE8021CB"/> capable the frame replication and duplicate
     elimination MAY [Ed: SHOULD, MUST?] entirely be done in the NSP.
    </t>
    <t>
     The DetNet-aware extended forwarder selects the egress segment PW based on
     the rules described in <xref target="RFC4448"/> and <xref
     target="RFC6658"/>.  In both NSP and Packet NSP cases there is no DetNet
     Control Word (CW) or DetNet label avaiable yet as it is the case with
     S-PEs (see <xref target="sec_s_pe"/>).  It is the responsibility of the
     extended forwarder within the DetNet-aware T-PE to push both DetNet CW and
     the DetNet label to the packet before forwarding it to the appropriate egress
     PW instance. The extended forwarder MAY copy the sequencing information
     from the native packet into the DetNet CW and vice versa. If there is no
     existing sequencing information available in the native packet or the
     forwarded chose not to copy it from the native packet, then the extended
     forwarded MUST maintain a sequence number counter for each DetNet flow it
     also assigns a DetNet label.
    </t>
   </section>


   <section title="S-DetNetPE processing clarifications" anchor="sec_s_pe">
    <t>
     The PW-based DetNet data plane solution overloads a S-PE with a DetNet
     Relay function. Such S-PE device is referred as S-DetNEt-PE and implies
     the S-PE is also aware of DetNet flows and may operate upon those. <xref
     target="fig_detnet_relay"/> illustrates the overall S-DetNet-PE device functions.
    </t>
    <t>
     DetNet-aware S-PE participates to the frame replication and
     duplication elimination. This processing is done within an
     extended forwarder function.
    </t>
    <t>
     The DetNet-aware forwarder selects the egress segment PW based on the
     DetNet label.  The mapping of DetNet label to egress PW label may be statically
     or dynamically configured. Additionally the DetNet-aware forwarder
     does duplicate frame elimination based on the DetNet label and DetNet
     Control Word combination. The frame replication is also done in
     the DetNet-aware forwarder. During elimination and the replication
     process both DetNet CW sequence number and DetNet label MUST be
     preserved and copied to the egress PW. The PW instance MUST NOT..

    </t>

    <figure title="DetNet Relay Node as a S-PE" anchor="fig_detnet_relay">
    <artwork align="center"><![CDATA[
            +---------------------------------------+
            |           S-DetNet-PE Device          |
            +---------------------------------------+
  Ingress   |             | Forwarder |             |   Egress
PW instance |   Single    |           |    Single   | PW Instance
----------->X PW Instance X --*-----> X PW Instance X----------->
            |             |   | Elim. |             |
            +-------------+   |       +-------------+ Duplicate
  Ingress   |             |   |       |             |   Egress
PW instance |   Single    |   |       |    Single   | PW Instance
----------->X PW Instance X --+   +-> X PW Instance X----------->
            |             |       |   |             |
            +-------------+       |   +-------------+
  Ingress   |             |       |   |             |   Egress
PW instance |   Single    | Repl. |   |    Single   | PW Instance
----------->X PW Instance X ------*-> X PW Instance X----------->
            |             |           |             |
            +-------------+           +-------------+
  Ingress   |             |           |             |   Egress
PW instance |   Single    |           |    Single   | PW Instance
----------->X PW Instance X --------> X PW Instance X----------->
            |             |           |             |
            +---------------------------------------+
]]>
    </artwork></figure>
  </section>

  <section title="Frame replication and elimination considerations">
   <t>
    [Ed. Describe the elimination and replication procedure here in more
     detail. This is going to take place in PW instance and consists of
     two step operation: 1) eliminate and 2) replicate if necessary.]
   </t>

  </section>
 </section>
</section>

<section title="Other DetNet considerations">
 <section title="Class of Service">
  <t>
   [Ed. Discuss the CoS.. and how that is archieved when using MPLS or IP PSN.]
  </t>
 </section>

 <section title="Quality of Service">
  <t>
   [Ed. Elaborate the QoS issues here..]
  </t>
 </section>

 <section title="Time-synchronization">
  <t>
   [Ed. discribe a bit of issues and deployment considerations related to
   time-synchronization within DetNet. Refer to DT discussion and the slides
   that summarize different approaches and rough synchronization performance
   numbers.  Finally, scope time-synchronization solution outside data plane.]
  </t>
 </section>
</section>


<!-- ===================================================================== -->


<section title="Security considerations">
  <t>
   This document probably has security considerations.
  </t>
</section>


<section anchor="iana" title="IANA Considerations">
  <t>TBD.
  </t>
</section>

<section anchor="acks" title="Acknowledgements">
  <t>The author(s) ACK and NACK.
  </t>
  <t> The following people were part of the DetNet Data Plane Protocol Design Team:
  <list style="bullets">
   <t>Jouni Korhonen</t>
   <t>J&aacute;nos Farkas</t>
   <t>Norman Finn</t>
   <t>Bal&aacute;zs Varga</t>
   <t>Loa Andersson</t>
   <t>Tal Mizrahi</t>
   <t>David Mozes</t>
   <t>Yuanlong Jiang</t>
  </list></t>
  <t>
   The DetNet chairs serving during the DetNet Data Plane Protocol Design Team:
   <list style="bullets">
    <t>Lou Berger</t>
    <t>Pat Thaler</t>
   </list></t>
</section>
</middle>

<back>
  <references title="Normative References">
   &rfc3985;
   &rfc3031;
   &rfc6073;
   &rfc4448;
   &rfc6658;
   &rfc4023;
   &rfc7510;
   &rfc2119;
  </references>
  <references title="Informative References">
   &rfc3032;
   &rfc4385;
   &rfc5921;
   &I-D.ietf-detnet-dp-alt;
   &I-D.ietf-detnet-architecture;
   &I-D.ietf-detnet-problem-statement;
   &I-D.ietf-mpls-residence-time;
   <reference anchor="IEEE8021CB"
     target="http://www.ieee802.org/1/files/private/cb-drafts/d2/802-1CB-d2-1.pdf">
    <front>
     <title>Draft Standard for Local and metropolitan area networks - Seamless Redundancy</title>
     <author initials="N. F." surname="Finn" fullname="Norman Finn">
      <organization>IEEE 802.1</organization>
     </author>
     <date month="December" year="2015"/>
    </front>
    <seriesInfo name="IEEE P802.1CB /D2.1" value="P802.1CB"/>
    <format type="PDF" target="http://www.ieee802.org/1/files/private/cb-drafts/d2/802-1CB-d2-1.pdf"/>
   </reference>

  </references>
 <section title="Example of DetNet data plane operation" anchor="sec_comb">
  <t>
   [Ed. Simplified example of DetNet data plane and how labels etc work in a case of
    MPLS-based PSN and utilizing FRER. The figure is out of date and pending DT
    decisions on the label handling..]
  </t>
    <figure title="Replication and elimination example" anchor="fig_detnet_ex1">
    <artwork align="center"><![CDATA[
E1 <----+       +-----S-PE1----R3-----S-PE3-----+       +----> E3 
         \     /        |             / |        \     /
          \   R1        |            /  |        R7   /
           \ /          |           /   |          \ /
          T-PE1         |         R4    |         T-PE2
           / \          |         /     |          / \
          /   R2        |  +-----+      |        R6   \
         /     \        | /             |        /     \
E2 <----+       +-----S-PE2---R5------S-PE4-----+       +----> E4
]]>
</artwork></figure>

    <figure title="LFIB contents" anchor="fig_lfib2">
    <artwork align="center"><![CDATA[
+========+================+===============+================================+
|        |                |  Elimination  |     Forwarding Semantics       |
| Device | Incoming-Label |---------------|--------------------------------|
|        |                | Virtual-label | Outgoing-Label | Outgoing-Link |
+========+================+===============+================+===============+
| T-PE1  | N/A (from AC)  |               |                | T-PE1->R1     |
|        |                |               |                | T-PE1->R2     |
+========+================+===============+================+===============+
| T-PE2  |                |               |                | T-PE2->E3     |
|        |                |               |                | T-PE2->E4     |
+========+================+===============+================+===============+
| S-PE1  |                |               |                |               |
+========+================+===============+================+===============+
| S-PE2  |                |               |                |               |
+========+================+===============+================+===============+
| S-PE3  |                |               |                |               |
+========+================+===============+================+===============+
| S-PE4  |                |               |                |               |
+========+================+===============+================+===============+
| R1     |                |     N/A       |                |               |
+========+================+===============+================+===============+
| R2     |                |     N/A       |                |               |
+========+================+===============+================+===============+
| R3     |                |     N/A       |                |               |
+========+================+===============+================+===============+
| R4     |                |     N/A       |                |               |
+========+================+===============+================+===============+
| R5     |                |     N/A       |                |               |
+========+================+===============+================+===============+
| R6     |                |     N/A       |                |               |
+========+================+===============+================+===============+
| R7     |                |     N/A       |                |               |
+========+================+===============+================+===============+
]]></artwork></figure>

 </section>

 <section title="Example of pinned paths using IP PSN">
 </section>

 </back>
</rfc>
