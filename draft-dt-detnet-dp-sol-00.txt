



DetNet                                                  J. Korhonen, Ed.
Internet-Draft                                                  Broadcom
Intended status: Informational                              L. Andersson
Expires: September 10, 2017                                     Y. Jiang
                                                                  Huawei
                                                                B. Varga
                                                                Ericsson
                                                                 D. Duck
                                                             Royal Bros.
                                                           March 9, 2017


                       DetNet Data Plane Protocol
                      draft-ietf-detnet-dp-sol-00

Abstract

   This document specifies a PseudoWire-based Determnistic Networking
   data plane protocol solutoon.  The data plane protocol runs over
   either IP or MPLS Packet Switched Networks.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on September 10, 2017.

Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect



Korhonen, et al.       Expires September 10, 2017               [Page 1]

Internet-Draft         DetNet data plane protocol             March 2017


   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   3
   3.  Requirements language . . . . . . . . . . . . . . . . . . . .   3
   4.  DetNet data plane Overview  . . . . . . . . . . . . . . . . .   4
     4.1.  DetNet data plane solution requirements . . . . . . . . .   5
   5.  DetNet data plane solution  . . . . . . . . . . . . . . . . .   6
     5.1.  DetNet Control Word . . . . . . . . . . . . . . . . . . .   6
     5.2.  DetNet flow identity word . . . . . . . . . . . . . . . .   6
     5.3.  DetNet encapsulation  . . . . . . . . . . . . . . . . . .   7
   6.  PE reference model considerations . . . . . . . . . . . . . .  10
     6.1.  Forwarded clarifications  . . . . . . . . . . . . . . . .  10
     6.2.  DA-T-PE processing clarifications . . . . . . . . . . . .  10
     6.3.  DA-S-PE processing clarifications . . . . . . . . . . . .  12
     6.4.  Frame replication and elimination considerations  . . . .  13
   7.  Other DetNet considerations . . . . . . . . . . . . . . . . .  13
     7.1.  Class of Service  . . . . . . . . . . . . . . . . . . . .  13
     7.2.  Quality of Service  . . . . . . . . . . . . . . . . . . .  13
     7.3.  Time-synchronization  . . . . . . . . . . . . . . . . . .  13
     7.4.  Bidirectional traffic . . . . . . . . . . . . . . . . . .  13
   8.  Control plane considerations  . . . . . . . . . . . . . . . .  13
     8.1.  PW Label assignment and distribution  . . . . . . . . . .  14
   9.  Security considerations . . . . . . . . . . . . . . . . . . .  14
   10. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  14
   11. Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  14
   12. References  . . . . . . . . . . . . . . . . . . . . . . . . .  15
     12.1.  Normative References . . . . . . . . . . . . . . . . . .  15
     12.2.  Informative References . . . . . . . . . . . . . . . . .  16
   Appendix A.  Example of DetNet data plane operation . . . . . . .  17
   Appendix B.  Example of pinned paths using IP PSN . . . . . . . .  18
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  18

1.  Introduction

   This document specifies a Deterministic Networking (DetNet) data
   plane protocol.  The solution is based on PseudoWires (PW) [RFC3985]
   and makes use of the multi-segment (MS-PW) [RFC6073] to map DetNet
   Relays and Edge Nodes
   [I-D.ietf-detnet-architecture][I-D.ietf-detnet-dp-alt] to PW
   architecture.  The PW-based data plane can be run over either an IP
   or MPLS [RFC4448][RFC6658] Packet Switched Network (PSN).




Korhonen, et al.       Expires September 10, 2017               [Page 2]

Internet-Draft         DetNet data plane protocol             March 2017


   For the purpose of DetNet data plane this document specifically
   specifies the PW encapsulation for DetNet flows, a DetNet Control
   Word (CW), a DetNet label, how MS-PW derived DetNet Relay and Edge
   nodes work, and as a specific new PW feature how the Frame
   Replication and Elimination for Redundancy (FRER) is implemented
   using PWs.  This document does not define the associated control
   plane functions, or operations and management (O&M).

2.  Terminology

   This document uses the terminology established in the DetNet
   architecture [I-D.ietf-detnet-architecture] and the DetNet Data Plane
   Solution Alternatives [I-D.ietf-detnet-dp-alt].

   The following terms are also used in this document:

   DA-T-PE       A DetNet aware PseudoWire Terminating Provider Edge
                 (T-PE).  In the context of this document DA-T-PE is
                 referred as T-PE.

   DA-S-PE       A DetNet aware PseudoWire Switching Provider Edge
                 (S-PE).  In the context of this document DA-S-PE is
                 referred as S-PE.

   T-Label       A hop-by-hop tunnel label layer between label switch
                 routers (LSR).

   L-Label       A DetNet topology overlay label that is used between
                 DetNet aware T-PE or S-PE devices.

   flow-ID       A DetNet flow identity that uniquely identifies a
                 DetNet flow in a DetNet domain.  The flow-ID is part of
                 the PseudoWire Encapsulation header.

   local-ID      A DA-T-PE and DA-S-PE node internal construct that
                 uniquelly identifies a DetNet flow.  The local-ID can
                 equal to flow-ID or be derived using other means e.g.,
                 programming required label to local-ID mappings
                 directly into the label information base (LFIB).

   PW label Label  A PseudoWire label that is used to identify DetNet
                 flows.

3.  Requirements language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL" "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].



Korhonen, et al.       Expires September 10, 2017               [Page 3]

Internet-Draft         DetNet data plane protocol             March 2017


4.  DetNet data plane Overview

   [Ed. to be written.. describe the scope here fot this document: this
   document only addresses the inter-connect case i.e., 802.1 over
   routed network (enlarge the layer-2 domain - EVPAN', and the native
   DetNet case.]

  TSN              Edge          Transit        Relay        DetNet
  End System       Node            Node         Node         End System

  +---------+    +.........+                                 +---------+
  |  Appl.  |<---:Svc Proxy:-- End to End Service ---------->|  Appl.  |
  +---------+    +---------+                   +---------+   +---------+
  |   TSN   |    |TSN| |Svc|<-- DetNet flow ---: Service :-->| Service |
  +---------+    +---+ +---+    +---------+    +---------+   +---------+
  |Transport|    |Trp| |Trp|    |Transport|    |Trp| |Trp|   |Transport|
  +-------.-+    +-.-+ +-.-+    +--.----.-+    +-.-+ +-.-+   +---.-----+
          :  Link  :    /  ,-----.  \   :  Link  :    /  ,-----.  \
          +........+    +-[  Sub  ]-+   +........+    +-[  Sub  ]-+
                          [Network]                     [Network]
                           `-----'                       `-----'

          Figure 1: A simple DetNet enabled network architecture

   Figure 2 illustrates how DetNet can provide services for IEEE
   802.1TSN end systems over a DetNet enabled network.  The edge nodes
   insert and remove required DetNet data plane encapsulation.  The 'X'
   in the edge and relay nodes represents a potential DetNet flow packet
   replication and elimination point.  This conceptually parallels L2VPN
   services, and could leverage existing related solutions as discussed
   below.

          TSN    |<----- End to End DetNet Service ----->|  TSN
         Service |        Transit          Transit       | Service
   TSN    (AC)   |     |<-Tunnel->|     |<-Tunnel->|     |  (AC)     TSN
   End     |     V     V     1    V     V     2    V     V   |       End
   System  |     +-----+          +-----+          +---- +   |    System
   +---+   |     |T-PE1|==========|S-PE1|==========|T-PE2|   |    +---+
   |   |---|-----|.X_..DetNet Flow1..X..|...DF3........X.|---|----|   |
   |CE1|   |     |  \  |          |     |          |  /  |   |    |CE2|
   |   |         |...X_...DF2........X..|...DF4......X_..|        |   |
   +---+         |     |==========|     |==========|     |        +---+
       ^         +-----+          +-----+          +-----+        ^
       |        Edge Node        Relay Node       Edge Node       |
       |                                                          |
       |<--------------- Emulated TSN Service ------------------->|

                    Figure 2: IEEE 802.1TSN over DetNet



Korhonen, et al.       Expires September 10, 2017               [Page 4]

Internet-Draft         DetNet data plane protocol             March 2017


   Figure 3 illustrates how end to end native DetNet service can be
   provided.  In this case, the end systems are able to send and receive
   native DetNet flows.  For example, as PseudoWire (PW) encapsulated
   IP.  Like earlier the 'X' in the end systems, edge and relay nodes
   represents potential DetNet flow packet replication and elimination
   points.  Here the relay nodes may change the underlying transport,
   for example replacing IP with MPLS or tunneling IP over MPLS (e.g.,
   via L3VPNs), or simply interconnect network domains.

          DetNet                                           DetNet
          Service         Transit          Transit        Service
   DetNet   |          |<-Tunnel->|     |<-Tunnel->|         |    DetNet
   End      |          V     1    V     V     2    V         |    End
   System   |    +-----+          +-----+          +-----+   |    System
   +---+    |    |S-PE1|==========|S-PE2|==========|S-PE3|   |    +---+
   |  X....DFa.....X_.......DF1.......X_....DF3........X.....DFa...X  |
   |CE1|=========|  \  |          |  /  |          |  /  |========|CE2|
   |   |    |    |   \......DF2.....X_......DF4....../   |   |    |   |
   +---+         |     |==========|     |==========|     |        +---+
       ^         +-----+          +-----+          +-----+        ^
       |        Relay Node       Relay Node       Relay Node      |
       |                                                          |
       |<------------- End to End DetNet Service ---------------->|

                          Figure 3: Native DetNet

4.1.  DetNet data plane solution requirements

   Two major groups of scenarios can be distinguished which require flow
   identification during transport:

   1.  DetNet function related scenarios:

       *  Congestion protection: usage of allocated resources (queuing,
          policing, shaping).

       *  Explicit routes: select/apply the flow specific path.

       *  Service protection: recognize compound / member flows for
          replication an elimination.

   2.  OAM function related scenarios:

       *  troubleshooting (e.g., identify misbehaving flows, etc.)

       *  recognize flow(s) for analytics (e.g, increase counters, etc.)





Korhonen, et al.       Expires September 10, 2017               [Page 5]

Internet-Draft         DetNet data plane protocol             March 2017


       *  correlate events with flows (e.g., volume above threshold,
          etc.)

       *  etc.

   Each node (DA-T-PE, DA-S-PE and P) use a local-ID of the DetNet-
   (compound)-flow in order to accomplish its role during transport.
   Recognizing the flow-ID is more relaxed for DA-T-PE and DA-S-PE
   nodes, as they are fully aware of both the DetNet service and
   transport layers.  The DetNet role of intermediate "P" nodes is
   limited to ensure congestion protection from the above listed DetNet
   functions.  However P nodes can usually recognize only "T-label" and
   cannot consider the whole label stack for flow recognition.
   Therefore identifing each individual DetNet flow on a P node may not
   be achieved in some network scenarios.

   On each node dealing with DetNet flows a local-ID is assumed to
   determine what local operation a packet goes through.  Therefore
   local-IDs MUST be unique on each DA-T-PE and DA-S-PE nodes.  Local-ID
   MUST be unambiguously bound to the Flow-ID encoded in the DetNet
   packet.

5.  DetNet data plane solution

5.1.  DetNet Control Word

   The DetNet control word (d-CW) is identical to the control word
   defined for Ethernet over MPLS networks in [RFC4448].  The DetNet
   control word is illustrated in Figure 4.

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |0 0 0 0|  reserved - set to 0  |   16 bit Sequence Number      |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                       Figure 4: DetNet Control Word

5.2.  DetNet flow identity word

   The DetNet flow identity word (flow-ID) identifies a DetNet flow
   uniquely within a DetNet domain.  The flow-ID is also associated with
   the sequence number carried in the DetNet control word and used also
   for FRER purposes.






Korhonen, et al.       Expires September 10, 2017               [Page 6]

Internet-Draft         DetNet data plane protocol             March 2017


      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |   reserved    |               24 bit flow identity            |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                    Figure 5: DetNet flow identity word

   The management and assignment of the flow-IDs is outside of this
   specification.  It is assumed that each DA-T-PE node have either a
   preconfigured flow-ID number space or some dynamic control plane
   protocol is able to coordinate the allocation of the flow-IDs across
   the DA-T-PE nodes.

   The reserved field in the flow-ID MUST be set to zero and ignored
   when received.

5.3.  DetNet encapsulation

   The DetNet data plane follows PW encapsulation.  This document
   specifies a single encapsulation that can be used over both MPLS and
   IP packet switched Networks (PSN).  The DetNet data plane
   encapsulation consists of a

   o  DetNet control word (d-CW): contains sequencing information for
      frame replication and duplicate elimination purposes.  There is a
      separate sequence number space per each DetNet label.

   o  DetNet flow-ID (f-ID): uniquelly identifies a DetNet flow within a
      DetNet domain.  Multiple DetNet PWs with different PW labels may
      have the same f-ID, which then implies the PWs are actually
      subflows of one compound flow.

   o  PseudoWire Label (PW Label;): a standard PW label that identifies
      a PW Instance within a (DA-)T-PE or (DA-)S-PE device.

   o  DetNet topology overlay label (L-label): an optional label used
      between (DA-)T-PE or (DA-)S-PE nodes.  The chief use for L-labels
      is to tunnel PWs through a PE node and therefore effectively
      making a PE node to behave like a P node.

   In a case of MPLS-based PSN, the tunnel labels between LSRs are
   referred as T-labels.

   The DetNet CW and the Detnet flow-ID together constitute the DetNet
   PseudoWire encapsulation header.




Korhonen, et al.       Expires September 10, 2017               [Page 7]

Internet-Draft         DetNet data plane protocol             March 2017


      [Editor's note: The current design has the DetNet flow-id as part
      of the every DetNet flow packet.  The flow-id identifies the flow
      uniquelly within the DetNet domain and together with the sequence
      number information from the DetNet control word is used for FRER
      purposes.  The flow-id makes is easy for the DA-*-PE node to
      associate different PWs into one compound flow and perform the
      elimination of duplicate packets.  The flow-id would point at the
      node internal construct that holds the received packet history for
      each DetNet flow of interest.  However, it could also be possible
      to associate multiple PWs into one DetNet flow just using the
      control plane provided information.  In this case different PWs
      (using any PW label) would be mapped internally within a node to a
      local-ID, which again points at the intenal per DetNet flow
      received packets history construct.  The explicit in-band flow-id
      is easy from the processing and control plane point of view.  The
      local-ID approach does not need the in-band information (thus has
      less overhead) but requires more from the control plane and the
      mapping information has to be stored into the LFIB.  Current
      design decision is the in-band flow-id but may be changed to
      local-ID if there is a strong reason to do the change.]

   Figure 6 illustrates a DetNet PseudoWire encapsulation using an MPLS
   PSN.  Similarly Figure 7 illustrates the DetNet PseudoWire
   encaosulation when IP PSN is used.  The encapsulation is uniform
   above the PSN.

   Depending on the network topology the "overlay label" may be part of
   the label stack.  This "L-label" has actually nothing specific to do
   with DetNet but can be used to build overlay topologies over the
   provider network in a same way virtual private networks (VPN) are
   built.




















Korhonen, et al.       Expires September 10, 2017               [Page 8]

Internet-Draft         DetNet data plane protocol             March 2017


    +-------------------------------+
    |                               |
    |          DetNet Flow          |
    |        Payload  Packet        |  n octets
    |                               |
    /===============================\           --+
    H      DetNet flow identity     H  4 octets   |
    H-------------------------------H             +-> PW encapsulation
    H      DetNet Control Word      H  4 octets   |
    \===============================/           --+
    |          PW Label             |  4 octets --> PW demultiplexer
    +-------------------------------+
    | DetNet topology overlay Label |  4 octets (optinal)
    +-------------------------------+
    |   Server MPLS Tunnel Label(s) |  n*4 octets
    +-------------------------------+


     Figure 6: Encapsulation of DetNet flow in a PW with MPLS(-TP) PSN

   When IP PSN is used the label stack it transport are only inspacted
   when the IP packet reaches its destination.

    +-------------------------------+
    |                               |
    |          DetNet Flow          |
    |        Payload  Packet        |  n octets
    |                               |
    /===============================\           --+
    H      DetNet flow identity     H  4 octets   |
    H-------------------------------H             +-> PW encapsulation
    H      DetNet Control Word      H  4 octets   |
    \===============================/           --+
    |          PW Label             |  4 octets --> PW demultiplexer
    +-------------------------------+
    | DetNet topology overlay Label |  4 octets (optional)
    +-------------------------------+
    |      Optional UDP Header      |  0 or 8 octets
    +-------------------------------+
    |      IPv4 or IPv6 Header      |  20 or 40 (or more octets
    +-------------------------------+  with extension headers)


        Figure 7: Encapsulation of DetNet flow in a PW with IP PSN







Korhonen, et al.       Expires September 10, 2017               [Page 9]

Internet-Draft         DetNet data plane protocol             March 2017


6.  PE reference model considerations

6.1.  Forwarded clarifications

   [Ed.  The Detnet-aware "extended forwarder" does the heavy lifting on
   maintaining the sequence numbers associated with the DetNet labels.
   Extended forwarder is also responsible for frame replication and
   duplicate elimination.  See the excerpt from RFC3985 Section 4.2.1.
   about forwarder's functions.  We extend that to FRER:

      Some applications have to forward payload elements selectively
      from one or more ACs to one or more PWs.  In such cases, there
      will also be a need to perform the inverse function on PWE3-PDUs
      received by a PE from the PSN.  This is the function of the
      forwarder.

   ]

6.2.  DA-T-PE processing clarifications

   The PW-based DetNet data plane solution overloads the T-PE with a
   DetNet Edge Node function.  Such T-PE is referred as DA-T-PE and
   implies the T-PE is also aware of DetNet flows and may need to
   operate upon those.  Figure 8 illustrates the overall DA-T-PE device
   functions.  The figure shows both physical attachment circuit (AC)
   (e.g., Ethernet [RFC4448]) connecting to the PE, and a packet service
   connecting to the PE via an embedded label switch router (LSR)
   function [RFC6658].























Korhonen, et al.       Expires September 10, 2017              [Page 10]

Internet-Draft         DetNet data plane protocol             March 2017


                 +---------------------------------------+
                 |             DA-T-PE Device            |
                 +---------------------------------------+   Egress/
                 |             | Forwarder |             |   Ingress
                 |  LSR        |           |    Single   | PW Instance
     Client PSN  |  ("Packet   X <-*-----> X PW Instance X<---------->
     LSPs        |    NSP")    |   | Repl. |             |
     <---------->X             |   | Elim. +-------------+ Duplicate
                 |             |   :       |             |   Egress
                 |             |   .       |    Single   | PW Instance
                 |             |       +-> X PW Instance X<---------->
                 |             |       |   |             |
                 +-------------+       |   +-------------+   Egress/
                 |             |       |   |             |   Ingress
     Client AC   |    NSP      | Repl. |   |    Single   | PW Instance
     <---------->X             X <-----*-> X PW Instance X<---------->
                 |             | Elim.     |             |
                 +-------------+           +-------------+   Egress/
                 |             |           |             |   Ingress
     Client AC   |    NSP      |           |    Single   | PW Instance
     <---------->X             X <-------> X PW Instance X<---------->
                 |             |           |             |
                 +---------------------------------------+


                   Figure 8: DetNet Edge Node as a T-PE

   A DA-T-PE participates to the frame replication and duplication
   elimination.  Required processing is done within an extended
   forwarder function.  In the case the native service processing (NSP)
   is IEEE 802.1CB [IEEE8021CB] capable the frame replication and
   duplicate elimination MAY entirely be done in the NSP and bypassing
   the DetNet PW encapsulation and logic entirely.

   The DetNet-aware extended forwarder selects the egress segment PW
   based on the rules described in [RFC4448] and [RFC6658].  In both
   "normal AC" and "Packet AC" cases there is no DetNet encapsulation
   header available yet as it is the case with DA-S-PEs (see
   Section 6.3).  It is the responsibility of the extended forwarder
   within the DA-T-PE to push the DetNet encapsulation header (i.e., the
   DetNet CW and the DetNet flow-ID) to the packet before forwarding it
   to the appropriate egress PW instance(s).  The extended forwarder MAY
   copy the sequencing information from the native packet into the
   DetNet CW and vice versa.  If there is no existing sequencing
   information available in the native packet or the forwarded chose not
   to copy it from the native packet, then the extended forwarded MUST
   maintain a sequence number counter for each DetNet flow (indexed by
   the flow-ID).



Korhonen, et al.       Expires September 10, 2017              [Page 11]

Internet-Draft         DetNet data plane protocol             March 2017


6.3.  DA-S-PE processing clarifications

   The PW-based DetNet data plane solution overloads a S-PE with a
   DetNet Relay function.  Such S-PE device is referred as DA-S-PE and
   implies the S-PE is also aware of DetNet flows and may operate upon
   those.  Figure 9 illustrates the overall DA-S-PE device functions.

   A DA-S-PE participates to the frame replication and duplication
   elimination.  This processing is done within an extended forwarder
   function.

   The DetNet-aware forwarder selects the egress segment PW based on the
   PW label.  The mapping of ingress PW label to egress PW label may be
   statically or dynamically configured.  Additionally the DetNet-aware
   forwarder does duplicate frame elimination based on the DetNet flow-
   ID and DetNet Control Word sequence number combination.  The frame
   replication is also done within the DetNet-aware forwarder.  During
   elimination and the replication process both DetNet CW sequence
   number and DetNet flow-ID MUST be preserved and copied to the egress
   PW.  [to be completed..]

                 +---------------------------------------+
                 |             DA-S-PE Device            |
                 +---------------------------------------+
       Ingress   |             | Forwarder |             |   Egress
     PW instance |   Single    |           |    Single   | PW Instance
     ----------->X PW Instance X --*-----> X PW Instance X----------->
                 |             |   | Elim. |             |
                 +-------------+   |       +-------------+ Duplicate
       Ingress   |             |   |       |             |   Egress
     PW instance |   Single    |   |       |    Single   | PW Instance
     ----------->X PW Instance X --+   +-> X PW Instance X----------->
                 |             |       |   |             |
                 +-------------+       |   +-------------+
       Ingress   |             |       |   |             |   Egress
     PW instance |   Single    | Repl. |   |    Single   | PW Instance
     ----------->X PW Instance X ------*-> X PW Instance X----------->
                 |             |           |             |
                 +-------------+           +-------------+
       Ingress   |             |           |             |   Egress
     PW instance |   Single    |           |    Single   | PW Instance
     ----------->X PW Instance X --------> X PW Instance X----------->
                 |             |           |             |
                 +---------------------------------------+


                   Figure 9: DetNet Relay Node as a S-PE




Korhonen, et al.       Expires September 10, 2017              [Page 12]

Internet-Draft         DetNet data plane protocol             March 2017


6.4.  Frame replication and elimination considerations

   [Editor's note: Describe the elimination and replication procedure
   here in more detail.  This is going to take place in PW instance and
   consists of two step operation: 1) eliminate and 2) replicate if
   necessary.]

   [Editor's note: draw here an example of LFIB with the elimination
   action.]

7.  Other DetNet considerations

7.1.  Class of Service

   [Ed.  Discuss the CoS.. and how that is archieved when using MPLS or
   IP PSN.]

7.2.  Quality of Service

   [Ed.  Elaborate the QoS issues here..]

7.3.  Time-synchronization

   [Ed. discribe a bit of issues and deployment considerations related
   to time-synchronization within DetNet.  Refer to DT discussion and
   the slides that summarize different approaches and rough
   synchronization performance numbers.  Finally, scope time-
   synchronization solution outside data plane.]

7.4.  Bidirectional traffic

   Some DetNet applications generate bidirectional traffic and may
   require symmetric flows.  There are already mechanisms that can be
   used to create bidirectional tunnels at the transport network level,
   such as MPLS-TP.  The data plane solution SHOULD allow establishing
   bidirectional symmetric flows.  Control plane mechanisms would need
   to also support this, though this is out of scope of this document.
   [Summary of existing mechanisms to create bidirectional tunnels that
   can be used.]

8.  Control plane considerations

   [Editor's note: discuss here what kind of enhancements are needed for
   DetNet and specifically for FRER.]







Korhonen, et al.       Expires September 10, 2017              [Page 13]

Internet-Draft         DetNet data plane protocol             March 2017


8.1.  PW Label assignment and distribution

   The PW label distribution follows the same mechanisms specified for
   MS-PW [RFC6073].

9.  Security considerations

   This document probably has security considerations.

10.  IANA Considerations

   TBD.

11.  Acknowledgements

   The author(s) ACK and NACK.

   The following people were part of the DetNet Data Plane Protocol
   Design Team:

      Jouni Korhonen

      Janos Farkas

      Norman Finn

      Balazs Varga

      Loa Andersson

      Tal Mizrahi

      David Mozes

      Yuanlong Jiang

      Carlos J.  Bernardos

   The DetNet chairs serving during the DetNet Data Plane Protocol
   Design Team:

      Lou Berger

      Pat Thaler







Korhonen, et al.       Expires September 10, 2017              [Page 14]

Internet-Draft         DetNet data plane protocol             March 2017


12.  References

12.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC3031]  Rosen, E., Viswanathan, A., and R. Callon, "Multiprotocol
              Label Switching Architecture", RFC 3031,
              DOI 10.17487/RFC3031, January 2001,
              <http://www.rfc-editor.org/info/rfc3031>.

   [RFC3985]  Bryant, S., Ed. and P. Pate, Ed., "Pseudo Wire Emulation
              Edge-to-Edge (PWE3) Architecture", RFC 3985,
              DOI 10.17487/RFC3985, March 2005,
              <http://www.rfc-editor.org/info/rfc3985>.

   [RFC4023]  Worster, T., Rekhter, Y., and E. Rosen, Ed.,
              "Encapsulating MPLS in IP or Generic Routing Encapsulation
              (GRE)", RFC 4023, DOI 10.17487/RFC4023, March 2005,
              <http://www.rfc-editor.org/info/rfc4023>.

   [RFC4448]  Martini, L., Ed., Rosen, E., El-Aawar, N., and G. Heron,
              "Encapsulation Methods for Transport of Ethernet over MPLS
              Networks", RFC 4448, DOI 10.17487/RFC4448, April 2006,
              <http://www.rfc-editor.org/info/rfc4448>.

   [RFC6073]  Martini, L., Metz, C., Nadeau, T., Bocci, M., and M.
              Aissaoui, "Segmented Pseudowire", RFC 6073,
              DOI 10.17487/RFC6073, January 2011,
              <http://www.rfc-editor.org/info/rfc6073>.

   [RFC6658]  Bryant, S., Ed., Martini, L., Swallow, G., and A. Malis,
              "Packet Pseudowire Encapsulation over an MPLS PSN",
              RFC 6658, DOI 10.17487/RFC6658, July 2012,
              <http://www.rfc-editor.org/info/rfc6658>.

   [RFC7510]  Xu, X., Sheth, N., Yong, L., Callon, R., and D. Black,
              "Encapsulating MPLS in UDP", RFC 7510,
              DOI 10.17487/RFC7510, April 2015,
              <http://www.rfc-editor.org/info/rfc7510>.








Korhonen, et al.       Expires September 10, 2017              [Page 15]

Internet-Draft         DetNet data plane protocol             March 2017


12.2.  Informative References

   [I-D.ietf-detnet-architecture]
              Finn, N. and P. Thubert, "Deterministic Networking
              Architecture", draft-ietf-detnet-architecture-00 (work in
              progress), September 2016.

   [I-D.ietf-detnet-dp-alt]
              Korhonen, J., Farkas, J., Mirsky, G., Thubert, P.,
              Zhuangyan, Z., and L. Berger, "DetNet Data Plane Protocol
              and Solution Alternatives", draft-ietf-detnet-dp-alt-00
              (work in progress), October 2016.

   [I-D.ietf-detnet-problem-statement]
              Finn, N. and P. Thubert, "Deterministic Networking Problem
              Statement", draft-ietf-detnet-problem-statement-01 (work
              in progress), September 2016.

   [I-D.ietf-mpls-residence-time]
              Mirsky, G., Ruffini, S., Gray, E., Drake, J., Bryant, S.,
              and S. Vainshtein, "Residence Time Measurement in MPLS
              network", draft-ietf-mpls-residence-time-15 (work in
              progress), March 2017.

   [IEEE8021CB]
              Finn, N., "Draft Standard for Local and metropolitan area
              networks - Seamless Redundancy", IEEE P802.1CB
              /D2.1 P802.1CB, December 2015,
              <http://www.ieee802.org/1/files/private/cb-drafts/
              d2/802-1CB-d2-1.pdf>.

   [RFC3032]  Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y.,
              Farinacci, D., Li, T., and A. Conta, "MPLS Label Stack
              Encoding", RFC 3032, DOI 10.17487/RFC3032, January 2001,
              <http://www.rfc-editor.org/info/rfc3032>.

   [RFC4385]  Bryant, S., Swallow, G., Martini, L., and D. McPherson,
              "Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for
              Use over an MPLS PSN", RFC 4385, DOI 10.17487/RFC4385,
              February 2006, <http://www.rfc-editor.org/info/rfc4385>.

   [RFC5921]  Bocci, M., Ed., Bryant, S., Ed., Frost, D., Ed., Levrau,
              L., and L. Berger, "A Framework for MPLS in Transport
              Networks", RFC 5921, DOI 10.17487/RFC5921, July 2010,
              <http://www.rfc-editor.org/info/rfc5921>.






Korhonen, et al.       Expires September 10, 2017              [Page 16]

Internet-Draft         DetNet data plane protocol             March 2017


Appendix A.  Example of DetNet data plane operation

   [Ed.  Simplified example of DetNet data plane and how labels etc work
   in a case of MPLS-based PSN and utilizing FRER.  The figure is out of
   date and pending DT decisions on the label handling..]

                     +-----S-PE1-----------S-PE2-----+
                    /        |             / |        \
                   /         |            /  |         \
                  /          |           /   |          \
     E1 <------T-PE1         |          /    |         T-PE2------> E3
                  \          |         /     |          /
                   \         |  +-----+      |         /
                    \        | /             |        /
                    R1-----S-PE3-----------S-PE4-----R2
                    /        | \             |        \
                   /         |  \            |         \
                  /          |   \           |          \
     E2 <------T-PE3         |    \          |         T-PE4------> E4
                  \          |     \         |          /
                   \         |      +-----+  |         /
                    \        |             \ |        /
                     +-----S-PE5-----------S-PE6-----+


              Figure 10: Replication and elimination example

























Korhonen, et al.       Expires September 10, 2017              [Page 17]

Internet-Draft         DetNet data plane protocol             March 2017


+========+================+===============+================================+
|        |                |  Elimination  |     Forwarding Semantics       |
| Device | Incoming-Label |---------------|--------------------------------|
|        |                |   local-ID    | Outgoing-Label | Outgoing-Link |
+========+================+===============+================+===============+
| T-PE1  | N/A (from AC)  |               |                |               |
|        |                |               |                |               |
+========+================+===============+================+===============+
| T-PE2  |                |               |                |               |
|        |                |               |                |               |
+========+================+===============+================+===============+
| T-PE3  | N/A (from AC)  |               |                |               |
|        |                |               |                |               |
+========+================+===============+================+===============+
| T-PE4  |                |               |                |               |
|        |                |               |                |               |
+========+================+===============+================+===============+
| S-PE1  |                |               |                |               |
+========+================+===============+================+===============+
| S-PE2  |                |               |                |               |
+========+================+===============+================+===============+
| S-PE3  |                |               |                |               |
+========+================+===============+================+===============+
| S-PE4  |                |               |                |               |
+========+================+===============+================+===============+
| S-PE5  |                |               |                |               |
+========+================+===============+================+===============+
| S-PE6  |                |               |                |               |
+========+================+===============+================+===============+
| R1     |                |     N/A       |                |               |
+========+================+===============+================+===============+
| R2     |                |     N/A       |                |               |
+========+================+===============+================+===============+

                         Figure 11: LFIB contents

Appendix B.  Example of pinned paths using IP PSN

Authors' Addresses

   Jouni Korhonen (editor)
   Broadcom
   3151 Zanker Road
   San Jose, CA  95134
   USA

   Email: jouni.nospam@gmail.com




Korhonen, et al.       Expires September 10, 2017              [Page 18]

Internet-Draft         DetNet data plane protocol             March 2017


   Loa Andersson
   Huawei

   Email: loa@pi.nu


   Yuanlong Jiang
   Huawei

   Email: jiangyuanlong@huawei.com


   Balazs Varga
   Ericsson

   Email: balazs.a.varga@ericsson.com


   Donald Fauntleroy Duck
   Royal Bros.
   13 Paradise Road
   Duckburg, Calisota
   USA




























Korhonen, et al.       Expires September 10, 2017              [Page 19]
